language: rust

sudo: false
branches:
  except:
    - staging.tmp

before_script:
  - git submodule update --init

jobs:
  include:
    - stage: install_rustfmt
      os: linux
      rust: stable
      script: rustup component add rustfmt
    - stage: install_rustfmt
      os: osx
      rust: stable
      script: rustup component add rustfmt
    - stage: install_rustfmt
      os: windows
      rust: stable
      script: rustup component add rustfmt
    - stage: test
      os: linux
      rust: stable
    - stage: test
      os: linux
      rust: nightly 
    - stage: test
      os: osx
      rust: stable
    - stage: test
      os: windows
      rust: stable

script:
  - cargo check --verbose
  - git diff --exit-code
  - cargo test --verbose

stages:
  - install_rustfmt
  - test
