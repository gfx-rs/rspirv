language: rust

sudo: false
matrix:
  fast_finish: true
  include:
    - os: linux
      rust: stable
    - os: linux
      rust: nightly
    - os: osx
      rust: stable
    - os: windows
      rust: stable

branches:
  except:
    - staging.tmp

before_script:
  - git submodule update --init

jobs:
  include:
    - stage: install_rustfmt
      script:
        - rustup component add rustfmt
    - stage: test
      script:
        - cargo check --verbose
        - git diff --exit-code
        - cargo test --verbose

stages:
  - name: install_rustfmt
    if: env(TRAVIS_RUST_VERSION) =~ stable
  - test
